<!doctype html>
<html lang="en">

    <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Fonts CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet">
    <!-- My CSS -->
    <link rel="stylesheet" href="{{url_for('static', filename='styles.css')}}">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <title>Index</title>

    </head>

    <body class="d-flex flex-column text-center" style="min-height: 100vh;">
        <div class="d-flex justify-content-between align-items-center" style="opacity: 0.4;">
            <a href="{{ url_for('main.index') }}" class="Style1">STUX</a>
            <div class="d-flex justify-content-evenly align-items-center" style="width: 50%;">
                <a href="{{ url_for('main.about') }}" class="pe-auto Style3">About</a>
                <a href="{{ url_for('main.features') }}" class="pe-auto Style3">Features</a>
                <a href="{{ url_for('main.support') }}" class="pe-auto Style3">Support</a>
            </div>
        </div>
        <div class="d-flex flex-column align-items-center" style="height: 85vh;">
            <div class="d-flex flex-column">
                <span class="Style1">Welcome to STUX!</span>
                <span class="Style10">The application that eases your</br>evaluation procedure when</br>conducting immersive media experiments.</span>
            </div>
            <div class="d-flex flex-column justify-content-center" style="height: 45vh;">
                <a href="{{ url_for('main.login') }}" class="indexbtn rounded-pill" type="button">Log In</a>
                <a href="{{ url_for('main.signup') }}" class="indexbtn rounded-pill" type="button">Register</a>
            </div>
        </div>
        <div id="container">
            <video autoplay="true" id="videoElement"></video>
            <img id="imageElement" src="{{ url_for('main.vidfeed') }}">
            <canvas id="canvasElement"></canvas>
        </div>
        <script type="text/javascript">
            $(document).ready(function() {
                let namespace = "/test";
                let video = document.querySelector("#videoElement");
                let canvas = document.querySelector("#canvasElement");
                let ctx = canvas.getContext('2d');
            
                var localMediaStream = null;
            
                var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
                
                function sendSnapshot() {
                if (!localMediaStream) {
                    return;
                }
            
                ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, 300, 150);
            
                let dataURL = canvas.toDataURL('image/jpeg');
                socket.emit('input image', dataURL);
                }
            
                socket.on('connect', function() {
                    console.log('Connected!');
                });
            
                var constraints = {
                video: {
                    width: { min: 640 },
                    height: { min: 480 }
                }
                };
            
                navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
                video.srcObject = stream;
                localMediaStream = stream;
            
                setInterval(function () {
                    sendSnapshot();
                }, 50);
                }).catch(function(error) {
                console.log(error);
                });
            });
        </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="{{url_for('static', filename='js/bootstrap.bundle.min.js')}}" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/5.2.0/socket.io.js"></script>
    </body>

</html>